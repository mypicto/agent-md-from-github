# GitHub PR Review Comments Collector

GitHubãƒªãƒã‚¸ãƒˆãƒªã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã¨Diffã‚’åŠ¹ç‡çš„ã«åé›†ã™ã‚‹Pythonãƒ„ãƒ¼ãƒ«ã€‚
åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ AI agent ãŒå‚ç…§ã™ã‚‹ `AGENT.md` ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

## ğŸš€ æ¦‚è¦

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€æŒ‡å®šã—ãŸGitHubãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚ŒãŸãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆinline commentsï¼‰ã¨é–¢é€£ã™ã‚‹DiffæŠœç²‹ã‚’è‡ªå‹•åé›†ã—ã¾ã™ã€‚åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ§‹é€ åŒ–ã—ã¦ä¿å­˜ã—ã€å¾Œç¶šã®åˆ†æã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã‚’æ”¯æ´ã—ã¾ã™ã€‚

ä¸»ãªæ©Ÿèƒ½ï¼š

- æŒ‡å®šæœŸé–“å†…ã®ã‚¯ãƒ­ãƒ¼ã‚ºæ¸ˆã¿PRã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆåé›†
- åé›†ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

## ğŸ“‹ å‰ææ¡ä»¶

### Pythonç’°å¢ƒ

- Python 3.8ä»¥ä¸Š
- å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼š`pip install -r requirements.txt`

### GitHubã‚¢ã‚¯ã‚»ã‚¹æ¨©é™

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®Personal Access TokenãŒå¿…è¦ã§ã™ï¼š

#### Fine-grained Tokenï¼ˆæ¨å¥¨ï¼‰

- ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯å¯¾è±¡å¤–
- å¿…è¦ãªæ¨©é™ï¼š
  - Pull requests: Read
  - Contents: Read
  - Metadata: Read
  - Issues: Read

#### Classic Token

- æ¨©é™ï¼š`repo`ï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®ãƒ•ãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼‰

## ğŸ” èªè¨¼è¨­å®š

### ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜ï¼ˆæ¨å¥¨ï¼‰

```bash
python scripts/src/auth.py --store-token "your_github_token_here"
```

### ä¸€æ™‚çš„ãªä½¿ç”¨

```bash
export GITHUB_TOKEN="your_github_token_here"
# ã¾ãŸã¯
python scripts/src/fetch.py --token "your_github_token_here"
```

### ãƒˆãƒ¼ã‚¯ãƒ³ã®å‰Šé™¤

```bash
python scripts/src/auth.py --clear-token
```

## ğŸ› ï¸ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### åŸºæœ¬çš„ãªåé›†

```bash
python scripts/src/fetch.py --repo "owner/repository" --from-date "2025-09-01" --to-date "2025-09-10"
```

### ã‚µãƒãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿æ¬ å¦‚ãƒã‚§ãƒƒã‚¯

```bash
python scripts/src/list_missing_summaries.py --repo "owner/repository"
```

### PRã‚³ãƒ¡ãƒ³ãƒˆã®å‡ºåŠ›

```bash
python scripts/src/get_comments.py --repo "owner/repository" --pr PR-123
```

## ğŸ“– è©³ç´°ãªä½¿ç”¨æ–¹æ³•

### åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|----------|------|
| `fetch.py` | PRãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã®åé›† |
| `list_missing_summaries.py` | ã‚µãƒãƒªãƒ¼ãŒä½œæˆã•ã‚Œã¦ã„ãªã„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã®æ¤œç´¢ |
| `get_comments.py` | æŒ‡å®šPRã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’Markdownå½¢å¼ã§å‡ºåŠ› |
| `set_summary.py` | PRã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦ç´„ã‚’è¨­å®š |
| `auth.py` | GitHubãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç† |

### fetch.py ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å¿…é ˆ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|------|-----------|
| `--repo` | âœ… | ãƒªãƒã‚¸ãƒˆãƒªåï¼ˆ`owner/repo`å½¢å¼ï¼‰ | - |
| `--from-date` | âœ… | é–‹å§‹æ—¥ï¼ˆ`YYYY-MM-DD`ï¼‰ | - |
| `--to-date` | âœ… | çµ‚äº†æ—¥ï¼ˆ`YYYY-MM-DD`ï¼‰ | - |
| `--output-dir` | âŒ | å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | `pullrequests` |
| `--timezone` | âŒ | ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ | `Asia/Tokyo` |
| `--token` | âŒ | GitHubãƒˆãƒ¼ã‚¯ãƒ³ | ç’°å¢ƒå¤‰æ•°/ã‚­ãƒ¼ãƒªãƒ³ã‚° |
| `--verbose` | âŒ | è©³ç´°å‡ºåŠ› | `False` |

### list_missing_summaries.py ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å¿…é ˆ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|------|-----------|
| `--repo` | âœ… | ãƒªãƒã‚¸ãƒˆãƒªåï¼ˆ`owner/repo`å½¢å¼ï¼‰ | - |
| `--output-dir` | âŒ | å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | `pullrequests` |

### get_comments.py ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å¿…é ˆ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|------|-----------|
| `--repo` | âœ… | ãƒªãƒã‚¸ãƒˆãƒªåï¼ˆ`owner/repo`å½¢å¼ï¼‰ | - |
| `--pr` | âœ… | PRç•ªå·ï¼ˆ`PR-<number>`å½¢å¼ï¼‰ | - |
| `--output-dir` | âŒ | å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | `pullrequests` |

### set_summary.py ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å¿…é ˆ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|------|-----------|
| `--repo` | âœ… | ãƒªãƒã‚¸ãƒˆãƒªåï¼ˆ`owner/repo`å½¢å¼ï¼‰ | - |
| `--pr` | âœ… | PRç•ªå· | - |
| `--priority` | âœ… | å„ªå…ˆåº¦ï¼ˆ`high`, `middle`, `low`ï¼‰ | - |
| `--file` | âœ… | è¦ç´„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ï¼ˆMarkdownå½¢å¼ï¼‰ | - |

### auth.py ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-----------|------|
| `--store-token` | ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚­ãƒ¼ãƒªãƒ³ã‚°ã«ä¿å­˜ |
| `--clear-token` | ä¿å­˜ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤ |

## ğŸ“ å‡ºåŠ›å½¢å¼

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```text
pullrequests/
â”œâ”€â”€ owner/
â”‚   â””â”€â”€ repository/
â”‚       â”œâ”€â”€ 2025-09-01/
â”‚       â”‚   â”œâ”€â”€ PR-123-metadata.json
â”‚       â”œâ”€â”€ 2025-09-02/
â”‚       â”‚   â”œâ”€â”€ PR-456-metadata.json
â”‚       â””â”€â”€ summaries/
â”‚           â”œâ”€â”€ PR-123-summary.md
â”‚           â””â”€â”€ PR-456-summary.md
```

### JSONãƒ‡ãƒ¼ã‚¿å½¢å¼

å„PRã®ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®æ§‹é€ ã§ä¿å­˜ã•ã‚Œã¾ã™ï¼š

```json
{
  "pr_number": 123,
  "closed_at_iso": "2025-09-01T12:34:56+09:00",
  "merged": true,
  "review_comments": [
    {
      "id": 4567890,
      "path": "src/app.py",
      "original_position": 42,
      "commit_id": "abc123def456...",
      "user": "reviewer1",
      "created_at": "2025-08-31T10:00:00+09:00",
      "body": "ã“ã“ã¯ä¾‹å¤–å‡¦ç†ã‚’è¿½åŠ ã—ãŸã„ã§ã™",
      "context_patch_excerpt": "@@ -40,6 +40,9 @@\n def process_data(data):\n+    if not data:\n+        raise ValueError('Data is required')\n     return data.upper()\n"
    }
  ]
}
```

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | åŸå›  | å¯¾å‡¦æ³• |
|-------------|------|--------|
| 401 | èªè¨¼å¤±æ•— | ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¨©é™ã‚’ç¢ºèª |
| 403 | ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é | æ™‚é–“ã‚’ç½®ã„ã¦å†è©¦è¡Œ |
| 404 | ãƒªãƒã‚¸ãƒˆãƒªã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ | ãƒªãƒã‚¸ãƒˆãƒªåã¨æ¨©é™ã‚’ç¢ºèª |

### è¿½åŠ ã®ãƒ’ãƒ³ãƒˆ

- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®šã§æ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’èª¿æ•´

